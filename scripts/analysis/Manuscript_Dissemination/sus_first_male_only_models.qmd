---
title: "male only sus first models"
format: docx
date: today
editor: visual
execute:
  enabled: true
df-print: kable
project: 
  execute-dir: project
---


# Linear Regression: SUS First Male-Only (Main Analyses)

## Model 1: FA \~ SUS + Age

## Model 2: FA \~ PCL-R + Age + IQ + SUS

Load Data

```{r, include=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(knitr)
library(broom)
library(gt)
library(dplyr)
library(stringr)

```

```{r}

roi_fa_male <-  read_csv(here("data", "raw", "rawdata_manuscript_FA.csv")) |>
filter(Gender == 0)|>
  rename(
    age  = Age...6,
    pclr = `PCL-R Total`,
    iq   = IQ,
    sus  = `Total Drug Use`
  ) |>
  filter(
    !is.na(pclr),
    !is.na(FA_mean)
  )
```

Number of Participants

```{r}
n_distinct(roi_fa_male$subject_id)
```

## Model 1: FA \~ SUS + Age

```{r}
models_fa_m1_male <- roi_fa_male |>
  group_by(roi) |>
  group_map(
    ~ lm(FA_mean ~ sus + age, data = .x),
    .keep = TRUE
  )

roi_names_all <- roi_fa_male |>
  distinct(roi) |>
  pull(roi)

names(models_fa_m1_male) <- roi_names_all

results_fa_m1_male <- map_dfr(
  names(models_fa_m1_male),
  ~ tidy(models_fa_m1_male[[.x]]) |>
    mutate(
      roi   = .x,
      model = "Model 1 (Male-Only Main Analyses)"
    )
)

results_fa_m1_male_sus <- results_fa_m1_male |>
  filter(term == "sus") |>
  mutate(p_fdr = p.adjust(p.value, method = "fdr"))

```

```{r}
#| execute:
#|   cache: false
results_fa_m1_male_sus |>
  select(
    roi,
    estimate,
    std.error,
    statistic,
    p.value,
    p_fdr
  ) |>
  arrange(p_fdr)
```

## Model 2: FA \~ PCL-R + Age + IQ + SUS

```{r}
roi_fa_model2_male <- roi_fa_male |>
  group_by(roi) |>
  group_map(
    ~ lm(FA_mean ~ pclr + age + iq + sus, data = .x),
    .keep = TRUE
  )


names(roi_fa_model2_male) <- roi_names_all

results_roi_fa_model2_male <- map_dfr(
  names(roi_fa_model2_male),
  ~ tidy(roi_fa_model2_male[[.x]]) |>
    mutate(
      roi = .x,
      model = "Model 2 (Male-Only: +IQ +SUS)"
    )
)


results_roi_fa_model2_sus_male <- results_roi_fa_model2_male |>
  filter(term == "sus") |>
  mutate(p_fdr = p.adjust(p.value, method = "fdr"))

```

Simple Output (Just SUS Effects)

```{r}
#| execute:
#|   cache: false
results_roi_fa_model2_sus_male |>
  select(
    roi,
    estimate,
    std.error,
    statistic,
    p.value,
    p_fdr
  ) |>
  arrange(p_fdr)
```

Full Regression Output

```{r}
#| execute:
#|   cache: false
results_apa <- results_roi_fa_model2_male |>
  mutate(
    estimate  = round(estimate, 3),
    statistic = round(statistic, 2),
    p.value   = round(p.value, 3),
    sig = case_when(
      p.value < .001 ~ "***",
      p.value < .01  ~ "**",
      p.value < .05  ~ "*",
      TRUE           ~ ""
    ),
    estimate = paste0(estimate, sig)
  ) |>
  select(
    term,
    estimate,
    statistic,
    p.value,
    roi,
    model
  )

results_apa |>
  gt() |>
  tab_header(
    title = md("**Table X**"),
    subtitle = md("*Hierarchical regression predicting FA (Model 2)*")
  ) |>
  cols_label(
    term      = "Predictor",
    estimate  = html("Estimate (<i>&beta;</i>)"),
    statistic = "t",
    p.value   = html("<i>p</i>"),
    roi       = "ROI",
    model     = "Model"
  ) |>
  fmt_number(
    columns = c(statistic, p.value),
    decimals = 3
  ) |>
  tab_source_note(
    source_note = md(
      "*Note.* FA = fractional anisotropy. Estimates are standardized regression coefficients. \
      *p* < .05*, **p* < .01**, ***p* < .001."
    )
  ) |>
  tab_options(
    table.border.top.style = "solid",
    table.border.bottom.style = "solid",
    column_labels.border.top.style = "solid",
    column_labels.border.bottom.style = "solid",
    table_body.border.bottom.style = "solid",
    table.border.left.style = "none",
    table.border.right.style = "none",
    heading.border.bottom.style = "none",
    column_labels.font.weight = "bold",
    table.font.size = 11,
    data_row.padding = px(4)
  )


```
